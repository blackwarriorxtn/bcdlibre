<script type="text/javascript">
// Bind form-related events and callbacks
$( document ).ready(function() {
  // Initial setup for required fields
  $(".form-control-required").each(function(index) {
    var strValue = $(this).val().replace(/^ +/g, "").replace(/ +$/g, "");
    if (strValue == "")
    {
      $(this).parent().addClass("has-error");
    }
  });
  // Check required fields when losing focus
  $(".form-control-required").on('focusout', function(event) {
    // Validate required field: MUST NOT be empty on focus out (otherwise we set the error class)
    var strValue = $(event.target).val().replace(/^ +/g, "").replace(/ +$/g, "");
    if (strValue == "")
    {
      $(event.target).parent().addClass("has-error").removeClass("has-success has-warning");
    }
    else
    {
      $(event.target).parent().removeClass("has-error has-warning").addClass("has-success");
    }
  });
  $("#_CANCEL").on('click', function(event) {
    // Remove all errors so that submit event can be processed without validation
    $(".has-error").removeClass("has-error");
  });

  // When use type on ESC key, cancel form (click on CANCEL button, if any)
  $("#_FORM_NEW").on('keyup', function(event) {
    if (event.which == 27 /* Esc */)
    {
      $("#_CANCEL").click();
    }
  });
  $("#_FORM_VIEW").on('keyup', function(event) {
    if (event.which == 27 /* Esc */)
    {
      $("#_CANCEL").click();
    }
  });
  $("#_FORM_NEW").on('submit', function(event) {
    var objErrors = $(".has-error");
    var blnValue = (objErrors.length == 0);
    if(blnValue)
    {
      // No error: do form submit, but do not send autocomplete fields
      $(".form-dont-submit").prop("disabled", true);
    }
    else
    {
      // There are errors: do not submit form (block callback)
      event.preventDefault();
      // Set focus on first field in error
      $(objErrors.first()).find(".form-control").focus();
    }
  });
  $("#_ADD").on('click', function(event) {
    // Redirect to new form
    window.location.href = "new";
  });
  $("#_MODIFY").on('click', function(event) {
    // Change form action
    $("#_FORM_VIEW").attr("action", "update");
    // Enable fieldset under form
    $("#_FORM_VIEW > fieldset").prop("disabled", false);
    // Disable Add/Modify/Delete buttons
    $("#_ADD").prop("disabled", true);
    $("#_MODIFY").prop("disabled", true);
    $("#_DELETE").prop("disabled", true);
    // Show OK/Cancel buttons
    $("#_OK_CANCEL").removeClass("hidden").addClass("show");
    // Set focus on first field
    form_control_autofocus("#_FORM_VIEW");
  });
  $("#_DELETE").on('click', function(event) {
    // Change form action
    $("#_FORM_VIEW").attr("action", "delete");
    // Let fieldset disabled
    // Disable Add/Modify/Delete buttons
    $("#_ADD").prop("disabled", true);
    $("#_MODIFY").prop("disabled", true);
    $("#_DELETE").prop("disabled", true);
    // Show OK/Cancel buttons
    $("#_OK_CANCEL").removeClass("hidden").addClass("show");
  });

  // Make clickable rows in tables - if they have the valide HTML5 attribute "data-href"
  $('tr[data-href]').click(function(){
    window.document.location = $(this).data("href");
  });

  // Set focus automatically
  form_control_autofocus(null /* strCSSParent */);
});

// Compute focus automatically and enforce it : Set focus on first visible non disabled mandatory field
function form_control_autofocus(strCSSParent)
{
  if (strCSSParent == null)
  {
    strCSSParent = "body";
  }
  $(strCSSParent).find(".form-control:enabled:visible:first").focus();
}

</script>
