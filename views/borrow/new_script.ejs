<script type="text/javascript">
// Bind events and callbacks
$(document).ready(function(){

  // Initial setup of autocomplete

  // Enable auto-complete feature (typeahead) for fields "item" and "user"
  $('#item_search').typeahead({
    hint: true,
    highlight: true,
    minLength: 3
  },
  {
    name: 'items',
    source: new Bloodhound({
      datumTokenizer: Bloodhound.tokenizers.whitespace('text'),
      queryTokenizer: Bloodhound.tokenizers.whitespace,
      // url points to a json web service that contains an array of item matching %QUERYSTRING
      remote: {
        url: 'webservice/items?action=borrow&text=%QUERYSTRING',
        wildcard: '%QUERYSTRING'
      },
      identify: function(obj) { return obj.id; }
    }),
    display: function (suggestion) {
      return(suggestion.text);
    }
  });

  $('#user_search').typeahead({
    hint: true,
    highlight: true,
    minLength: 1
  },
  {
    name: 'users',
    source: new Bloodhound({
      datumTokenizer: Bloodhound.tokenizers.whitespace,
      queryTokenizer: Bloodhound.tokenizers.whitespace,
      // url points to a json web service that contains an array of users
      remote: {
        url: 'webservice/users?action=borrow&text=%QUERYSTRING',
        wildcard: '%QUERYSTRING'
      },
      identify: function(obj) { return obj.id; }
    }),
    display: function (suggestion) {
      return(suggestion.text);
    }
  });

  // Callbacks for auto-completion
  $('#item_search').bind('typeahead:select', function(event, suggestion) {
    console.log('Selection: ',suggestion);
    // Store selection id in hidden field
    $("#item_id").val(suggestion.id);
    // Set success on form control
    $(event.target).closest(".form-group").removeClass("has-error has-warning").addClass("has-success");
    // Set focus on next field (user)
    $("#user_search").focus();
  }).bind('typeahead:render', function(event) {
    // Automatically select first option returned by autocomplete
    $(event.target).parent().find('.tt-selectable:first').addClass('tt-cursor');
  });
  $('#user_search').bind('typeahead:select', function(event, suggestion) {
    console.log('Selection: ',suggestion);
    // Store selection id in hidden field
    $("#user_id").val(suggestion.id);
    // Set success on form control
    $(event.target).closest(".form-group").removeClass("has-error has-warning").addClass("has-success");
  }).bind('typeahead:render', function(event) {
    // Automatically select first option returned by autocomplete
    $(event.target).parent().find('.tt-selectable:first').addClass('tt-cursor');
  });

});
</script>
